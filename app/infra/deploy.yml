---
- name: Deploy Scientific Calculator Docker Container
  hosts: local
  # Setting become: false is correct if you have permissions to run Docker without sudo.
  # If not, you must use 'become: true' and provide a sudo password via -K or Ansible Vault.
  become: false
  tasks:
    - name: Pull Calculator Docker Image
      community.docker.docker_image:
        name: pratster20/miniproj_image1
        tag: "1.0"
        source: pull

    - name: Stop and remove old calculator container
      community.docker.docker_container:
        name: calculator
        state: absent # ensures the container is stopped and removed
        force_kill: true

    - name: Run Calculator Container as an Interactive Process
      community.docker.docker_container:
        name: calculator
        image: pratster20/miniproj_image1:1.0
        # NOTE: Using 'started' state here means Ansible will try to run this in the background.
        # This will fail unless the Ansible connection is fully TTY-enabled.
        state: started
        restart_policy: always
        interactive: true
        tty: true
        # CLI Command to execute the interactive application
        command: ["java", "-cp", "/app/target/classes", "com.calculator.App"]
        ports:
           - "8081:8080"
